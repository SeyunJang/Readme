name: Set-Common-Env-Composite
description: Set common environment variables using composite action

runs:
    using: "composite"
    steps:
      - name: Set SERVICE_NAME variable
        shell: bash
        run: echo "SERVICE_NAME=$(echo ${{ github.repository }} | cut -d'-' -f5- | sed 's/-api//g')" >> $GITHUB_ENV
    
      - name: Detect repository language
        shell: bash
        run: |
          if [ -e package.json ]; then
            echo "CODE_LANGUAGE=nodejs" >> $GITHUB_ENV
          elif [ -e go.mod ]; then
            echo "CODE_LANGUAGE=golang" >> $GITHUB_ENV
          else
            echo "Error : Unknown environment, this should never happen"
          fi
          
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          role-to-assume: ${{ secrets.RD_AWS_BOT_ROLE }}
          aws-region: ap-northeast-1